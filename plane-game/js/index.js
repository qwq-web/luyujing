"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,i){if(e){if("string"==typeof e)return _arrayLikeToArray(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,i):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,a=new Array(i);n<i;n++)a[n]=e[n];return a}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var n=0;n<i.length;n++){var a=i[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,i,n){return i&&_defineProperties(e.prototype,i),n&&_defineProperties(e,n),e}function _defineProperty(e,i,n){return i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function callAlert(e,i){var n=document.createElement("div"),a=document.createElement("div");return Object.assign(n.style,{width:"100%",height:"100%",top:0,left:0,position:"absolute",zIndex:2}),Object.assign(a.style,{width:"50%",lineHeight:"40px",margin:"260px auto 0",border:"1px solid",textAlign:"center",borderRadius:"20px",backgroundColor:"#ccc",cursor:"pointer"}),a.innerHTML=e,a.addEventListener("click",function(){i&&i(),n.remove()}),n.appendChild(a),n}var Main=function(){function t(e){_classCallCheck(this,t),this.main=e,this.init()}return _createClass(t,[{key:"init",value:function(){this.render(),this.handle(),t.bgMusic.loop=!0}},{key:"render",value:function(){Object.assign(this.main.style,{margin:"0 auto",border:"1px solid",width:"320px",height:"568px",backgroundImage:"url('./images/startBG.png')",position:"relative",overflow:"hidden"}),this.startGameBtn=document.createElement("button"),t.jiFenBoxNode=document.createElement("div"),Object.assign(t.jiFenBoxNode.style,{position:"absolute",left:0,top:0,padding:"10px",zIndex:9,color:"red"}),this.startGameBtn.innerHTML="开始游戏",Object.assign(this.startGameBtn.style,{width:"160px",height:"40px",borderRadius:"20px",border:"1px solid",outlineWidth:"0",backgroundColor:"transparent",position:"absolute",bottom:"120px",left:"calc(50% - 80px)"}),this.main.appendChild(this.startGameBtn)}},{key:"handle",value:function(){this.startGameBtn.addEventListener("click",this.gameStart.bind(this))}},{key:"diPlanRun",value:function(){var i=this,n=[{src1:"./images/enemy1_fly_1.png",srcBoom:"./images/小飞机爆炸.gif",w:34,h:24,id:1},{src1:"./images/enemy3_fly_1.png",srcAiDa:"./images/中飞机挨打.png",srcBoom:"./images/中飞机爆炸.gif",w:46,h:60,id:2},{src1:"./images/enemy2_fly_1.png",srcAiDa:"./images/大飞机挨打.png",srcBoom:"./images/大飞机爆炸.gif",w:110,h:164,id:3}];clearInterval(t.diPlanTimer),t.diPlanTimer=setInterval(function(){var e=parseInt(8*Math.random()),e=new DiFangPlane(n[e=e<4?0:4<=e&&e<7?1:2],1<=t.speed?1:t.speed+=.02);t.timers.push(e.timer),t.diPlanes.push(e),i.main.appendChild(e.diFangPlaneNode),0!=t.shadishu&&t.shadishu%100==0&&(t.jiaQiang=!0,clearInterval(t.createDiJiTimer),clearInterval(t.diPlanTimer),t.bossFlag=!1,t.boss=new Boss,i.main.appendChild(t.boss.diFangPlaneNode))},1e3-480*t.speed-(t.jiaQiang?220:200))}},{key:"gameStart",value:function(){var n=this;t.bgMusic.play(),t.jiFenBoxNode.innerHTML="",this.main.appendChild(t.jiFenBoxNode),this.startGameBtn.remove(),this.main.style.backgroundImage="url('./images/background_1.png')";var e=0;t.timers.push(setInterval(function(){n.main.style.backgroundPosition="0px ".concat(e++,"px")},20));var i=new MyPlane;t.myPlane=i,this.main.appendChild(i.plane),this.diPlanRun(),t.createDiJiTimer=setInterval(function(){n.diPlanRun()},2e3),t.timers.push(t.createDiJiTimer),clearInterval(t.daojuTiemr),t.daojuTiemr=setInterval(function(){var e,i=parseInt(5*Math.random());1==i?(e=new DaoJu(1),n.main.appendChild(e.daojuNode)):2==i&&(i=new DaoJu(2),n.main.appendChild(i.daojuNode))},2200);var a=document.createElement("p");a.innerHTML="分数:0";i=document.createElement("p");i.innerHTML="杀敌数:0",t.jiFenBoxNode.appendChild(a),t.jiFenBoxNode.appendChild(i)}}]),t}();_defineProperty(Main,"timers",[]),_defineProperty(Main,"zidans",[]),_defineProperty(Main,"diPlanes",[]),_defineProperty(Main,"fenshu",0),_defineProperty(Main,"shadishu",0),_defineProperty(Main,"speed",.2),_defineProperty(Main,"bossFlag",!0),_defineProperty(Main,"bgMusic",new Audio("./audio/bgm.mp3")),_defineProperty(Main,"gameoverMusic",new Audio("./audio/gameover.mp3")),_defineProperty(Main,"jiaQiang",!1);var MyPlane=function(){function e(){_classCallCheck(this,e),this.init()}return _createClass(e,[{key:"init",value:function(){this.render(),this.handle()}},{key:"render",value:function(){this.plane=document.createElement("img"),this.plane.src="./images/myPlane.gif",this.x=127,this.y=488,Object.assign(this.plane.style,{position:"absolute",top:this.y+"px",left:this.x+"px"})}},{key:"handle",value:function(){var n=this;Main.keydownFn=function(e){switch((e=e||window.event).key||e.keyCode){case"w":case"W":case 87:if(n.timerT)return;n.timerT=setInterval(function(){n.plane.offsetTop<=10?n.y=10:--n.y,n.plane.style.top=n.y+"px"},5);break;case"s":case"S":case 83:if(n.timerB)return;n.timerB=setInterval(function(){488<=n.plane.offsetTop?n.y=488:n.y+=1,n.plane.style.top=n.y+"px"},5);break;case"a":case"A":case 65:if(n.timerL)return;n.timerL=setInterval(function(){n.plane.offsetLeft<=0?n.x=0:--n.x,n.plane.style.left=n.x+"px"},5);break;case"d":case"D":case 68:if(n.timerR)return;n.timerR=setInterval(function(){254<=n.plane.offsetLeft?n.x=254:n.x+=1,n.plane.style.left=n.x+"px"},5);break;case"0":case"Enter":case 96:case 13:if(n.timerZiDan||n.gongJiFlag)return;n.gongJiFlag=!0,setTimeout(function(){n.gongJiFlag=!1},180);var i=new Zidan(n.plane.offsetLeft+29,n.plane.offsetTop-10);n.plane.parentNode.appendChild(i.zidanNode),Main.zidans.push(i),Main.runLiaoJi&&n.startLiaoJi(),new Audio("./audio/ndo.mp3").play(),n.timerZiDan=setInterval(function(){var e=new Zidan(n.plane.offsetLeft+29,n.plane.offsetTop-10);n.plane.parentNode.appendChild(e.zidanNode),Main.zidans.push(e),Main.runLiaoJi&&n.startLiaoJi(),new Audio("./audio/ndo.mp3").play()},200)}},document.addEventListener("keydown",Main.keydownFn),Main.keyupFn=function(e){switch((e=e||window.event).key||e.keyCode){case"w":case"W":case 87:clearInterval(n.timerT),n.timerT=null;break;case"s":case"S":case 83:clearInterval(n.timerB),n.timerB=null;break;case"a":case"A":case 65:clearInterval(n.timerL),n.timerL=null;break;case"d":case"D":case 68:clearInterval(n.timerR),n.timerR=null;break;case"0":case"Enter":case 96:case 13:clearInterval(n.timerZiDan),n.timerZiDan=null}},document.addEventListener("keyup",Main.keyupFn),Main.TCMoveFn=function(e){n.x=e.targetTouches[0].clientX-n.plane.parentNode.offsetLeft-35,n.y=e.targetTouches[0].clientY-n.plane.parentNode.offsetTop-40,254<n.x?n.x=254:n.x<0&&(n.x=0),488<n.y?n.y=488:n.y<0&&(n.y=0),n.plane.style.left=n.x+"px",n.plane.style.top=n.y+"px"},Main.TCEndFn=function(e){e.preventDefault(),document.removeEventListener("touchmove",Main.TCMoveFn)},Main.TCStratFn=function(e){e.preventDefault(),document.addEventListener("touchmove",Main.TCMoveFn)},this.plane.addEventListener("touchstart",Main.TCStratFn),this.plane.addEventListener("touchend",Main.TCEndFn),/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)&&(this.timerZiDan=setInterval(function(){var e=new Zidan(n.plane.offsetLeft+29,n.plane.offsetTop-10);n.plane.parentNode.appendChild(e.zidanNode),Main.zidans.push(e),Main.runLiaoJi&&n.startLiaoJi(),new Audio("./audio/ndo.mp3").play()},200),_toConsumableArray(document.getElementsByClassName("titleH")).forEach(function(e){e.style.display="none"}))}},{key:"startLiaoJi",value:function(){var e=new Zidan(this.plane.offsetLeft+6,this.plane.offsetTop+6);this.plane.parentNode.appendChild(e.zidanNode),Main.zidans.push(e);e=new Zidan(this.plane.offsetLeft+52,this.plane.offsetTop+6);this.plane.parentNode.appendChild(e.zidanNode),Main.zidans.push(e)}},{key:"over",value:function(){clearInterval(this.timerT),this.timerT=null,clearInterval(this.timerB),this.timerB=null,clearInterval(this.timerL),this.timerL=null,clearInterval(this.timerR),this.timerR=null,clearInterval(this.timerZiDan),this.timerZiDan=null,this.plane.src="./images/本方飞机爆炸.gif",Main.boss&&clearInterval(Main.boss.timer),Boss.flag=!1,clearInterval(Main.daojuTiemr),Main.gameoverMusic.play(),Main.bgMusic.pause(),document.removeEventListener("touchmove",Main.TCMoveFn),Main.timers.forEach(function(e){clearInterval(e)}),clearInterval(Main.diPlanTimer),document.removeEventListener("keydown",Main.keydownFn),document.removeEventListener("keyup",Main.keyupFn),Main.myPlane.plane.parentNode.appendChild(callAlert("重新开始",function(){Main.bgMusic.load(),Main.bgMusic.pause(),Main.myPlane.plane.parentNode.innerHTML="",Main.zidans.length=0,Main.diPlanes.length=0,Main.timers.length=0,Main.speed=.2,Main.runLiaoJi=!1,Main.fenshu=0,Main.shadishu=0,Main.bossFlag=!0,Main.bgMusic.src="./audio/bgm.mp3",main.gameStart()}))}}]),e}(),Zidan=function(){function n(e,i){_classCallCheck(this,n),this.x=e,this.y=i,this.init()}return _createClass(n,[{key:"init",value:function(){this.render(),this.handle()}},{key:"render",value:function(){this.zidanNode=document.createElement("div"),Object.assign(this.zidanNode.style,{position:"absolute",width:"8px",height:"12px",borderRadius:"60%",border:"1px solid #000",backgroundColor:"rgb(".concat(255*Math.random(),",").concat(255*Math.random(),",").concat(255*Math.random(),")"),top:this.y+"px",left:this.x+"px"})}},{key:"handle",value:function(){var e=this;this.timer=setInterval(function(){e.zidanNode.offsetTop<=0&&e.over(),e.y=e.y-2,e.zidanNode.style.top=e.y+"px"},4)}},{key:"over",value:function(){-1!=Main.zidans.indexOf(this)&&Main.zidans.splice(Main.zidans.indexOf(this),1),clearInterval(this.timer),this.zidanNode.remove()}}]),n}(),DiFangPlane=function(){function n(e,i){_classCallCheck(this,n),this.srcObj=e,this.speed=i,this.aiDaCiShu=0,this.init()}return _createClass(n,[{key:"init",value:function(){this.render(),this.handle()}},{key:"render",value:function(){this.diFangPlaneNode=document.createElement("img"),this.diFangPlaneNode.src=this.srcObj.src1,this.y=-this.srcObj.h,this.x=Math.random()*(320-this.srcObj.w),Object.assign(this.diFangPlaneNode.style,{position:"absolute",top:this.y+"px",left:"".concat(this.x,"px")})}},{key:"handle",value:function(){var i=this;this.timer=setInterval(function(){568<i.diFangPlaneNode.offsetTop&&i.over(),Main.zidans.forEach(function(e){e.x+10>i.x&&e.x<i.x+i.srcObj.w&&e.y<=i.y+i.srcObj.h&&e.y+20>i.y&&(e.over(),Main.jiFenBoxNode.firstElementChild.innerHTML="分数:".concat(++Main.fenshu),1==i.srcObj.id?i.diPlanOverFn():2==i.srcObj.id?(i.aiDaCiShu+=1,3<=i.aiDaCiShu?i.diPlanOverFn():i.aiDa()):3==i.srcObj.id&&(i.aiDaCiShu+=1,5<=i.aiDaCiShu?i.diPlanOverFn():i.aiDa()))}),Main.myPlane.x+66>i.x&&Main.myPlane.x<i.x+i.srcObj.w&&Main.myPlane.y<=i.y+i.srcObj.h&&Main.myPlane.y+60>i.y&&Main.myPlane.over(),i.y+=i.speed,i.diFangPlaneNode.style.top=i.y+"px"},6)}},{key:"diPlanOverFn",value:function(){this.over(),Main.jiFenBoxNode.lastElementChild.innerHTML="杀敌数:".concat(++Main.shadishu)}},{key:"over",value:function(){var e=this;-1!=Main.timers.indexOf(this.timer)&&Main.timers.splice(Main.timers.indexOf(this.timer),1),-1!=Main.diPlanes.indexOf(this)&&Main.diPlanes.splice(Main.diPlanes.indexOf(this),1),this.diFangPlaneNode.src=this.srcObj.srcBoom,clearInterval(this.timer),setTimeout(function(){e.diFangPlaneNode.remove()},80)}},{key:"aiDa",value:function(){this.diFangPlaneNode.src=this.srcObj.srcAiDa}}]),n}(),DaoJu=function(){function i(e){_classCallCheck(this,i),this.typeNum=e,this.init()}return _createClass(i,[{key:"init",value:function(){this.render(),this.handle()}},{key:"render",value:function(){this.daojuNode=document.createElement("img"),1==this.typeNum?(this.daojuNode.src="./images/bullet_supply.png",this.y=-88,this.w=58,this.h=88):(this.daojuNode.src="./images/bomb_supply.png",this.y=-107,this.w=60,this.h=107),this.x=262*Math.random(),Object.assign(this.daojuNode.style,{position:"absolute",top:this.y+"px",left:this.x+"px",zIndex:2})}},{key:"handle",value:function(){var e=this;this.timer=setInterval(function(){if(568<e.daojuNode.offsetTop&&e.over(),Main.myPlane.x+66>e.x&&Main.myPlane.x<e.x+e.w&&Main.myPlane.y<=e.y+e.h&&Main.myPlane.y+80>e.y){if(1==e.typeNum)new Audio("./audio/chi.mp3").play(),clearTimeout(Main.LiaoJiTimerOut),Main.runLiaoJi=!0,Main.LiaoJiTimerOut=setTimeout(function(){Main.runLiaoJi=!1},1e4);else{new Audio("./audio/bigboom.mp3").play(),Main.shadishu+=Main.diPlanes.length,Main.haveBoss?(Main.jiFenBoxNode.firstElementChild.innerHTML="分数:".concat(Main.fenshu+=20),Main.boss.aiDaCiShu+=20):Main.jiFenBoxNode.firstElementChild.innerHTML="分数:".concat(Main.fenshu+=2*Main.diPlanes.length),Main.jiFenBoxNode.lastElementChild.innerHTML="杀敌数:".concat(Main.shadishu);for(;0<Main.diPlanes.length;)Main.diPlanes[0].over()}e.over()}e.y+=1,e.daojuNode.style.top=e.y+"px"},10),Main.timers.push(this.timer)}},{key:"over",value:function(){-1!=Main.timers.indexOf(this.timer)&&Main.timers.splice(Main.timers.indexOf(this.timer),1),this.daojuNode.remove(),clearInterval(this.timer)}}]),i}(),BossZiDan=function(){function t(e,i,n,a){_classCallCheck(this,t),this.x=e,this.y=i,this.bossX=e,this.myPlaneX=n,this.myPlaneY=a,this.bgN=0,this.init()}return _createClass(t,[{key:"init",value:function(){this.render(),this.handle()}},{key:"render",value:function(){this.zidanNode=document.createElement("div"),Object.assign(this.zidanNode.style,{position:"absolute",width:"16px",height:"16px",borderRadius:"50%",backgroundColor:"red",boxShadow:"0 0 4px rgb(255, 72, 0)",top:this.y+"px",left:this.x+"px"})}},{key:"handle",value:function(){var e=this;this.timer=setInterval(function(){568<=e.zidanNode.offsetTop&&e.over(),e.zidanNode.style.backgroundColor=String(e.bgN++)[String(e.bgN).length-3]%2==0?"red":"yellow",e.y+=e.myPlaneY/400,e.x+=(e.myPlaneX-e.bossX)/400,e.zidanNode.style.top=e.y+"px",e.zidanNode.style.left=e.x+"px",Main.myPlane.x+66>e.x&&Main.myPlane.x<e.x+16&&Main.myPlane.y<=e.y+16&&Main.myPlane.y+60>e.y&&Main.myPlane.over()},10)}},{key:"over",value:function(){-1!=Main.timers.indexOf(this.timer)&&Main.timers.splice(Main.timers.indexOf(this.timer),1),Main.zidans.splice(Main.zidans.indexOf(this),1),clearInterval(this.timer),this.zidanNode.remove()}}]),t}(),BossZiDanJiGuang=function(){function n(e,i){_classCallCheck(this,n),this.x=e,this.y=i,this.init()}return _createClass(n,[{key:"init",value:function(){this.render(),this.handle()}},{key:"render",value:function(){this.zidanNode=document.createElement("img"),this.zidanNode.src="./images/fire.png",Object.assign(this.zidanNode.style,{position:"absolute",width:"58px",height:"117px",top:this.y+"px",left:this.x+"px"})}},{key:"handle",value:function(){var e=this;this.timer=setInterval(function(){568<=e.zidanNode.offsetTop&&e.over(),e.y+=1,e.zidanNode.style.top=e.y+"px",Main.myPlane.x+66>e.x&&Main.myPlane.x<e.x+58&&Main.myPlane.y<=e.y+117&&Main.myPlane.y+60>e.y&&Main.myPlane.over()},10)}},{key:"over",value:function(){-1!=Main.timers.indexOf(this.timer)&&Main.timers.splice(Main.timers.indexOf(this.timer),1),Main.zidans.splice(Main.zidans.indexOf(this),1),clearInterval(this.timer),this.zidanNode.remove()}}]),n}(),Boss=function(){function n(){_classCallCheck(this,n),this.bossZidanNum=0,this.srcObj={src1:"./images/boss.png",srcBoom:"./images/boomx.png",w:160,h:118},this.aiDaCiShu=0,this.init()}return _createClass(n,[{key:"init",value:function(){Main.haveBoss=!0,n.flag=!1,Main.bgMusic.src="./audio/boss.mp3",Main.bgMusic.play(),new Audio("./audio/bossrun.mp3").play(),this.render(),this.handle()}},{key:"render",value:function(){this.diFangPlaneNode=document.createElement("img"),this.diFangPlaneNode.src=this.srcObj.src1,this.y=-this.srcObj.h,this.x=Math.random()*(320-this.srcObj.w),this.tempX=1,this.tempY=1,Object.assign(this.diFangPlaneNode.style,{position:"absolute",top:this.y+"px",left:"".concat(this.x,"px"),zIndex:3}),this.xueTiaoNode=document.createElement("div"),Object.assign(this.xueTiaoNode.style,{position:"absolute",top:"10px",left:"0px",boxSizing:"border-box",boxShadow:"0 0 2px yellow",borderRadius:"5px",width:"100%",height:"10px",borderLeft:"320px solid red"}),Main.myPlane.plane.parentNode.appendChild(this.xueTiaoNode)}},{key:"handle",value:function(){var i=this;this.timer=setInterval(function(){return 500<=i.aiDaCiShu?(Main.haveBoss=!1,void i.over()):(Main.zidans.forEach(function(e){e.x+10>i.x&&e.x<i.x+i.srcObj.w&&e.y<=i.y-16+i.srcObj.h&&e.y+20>i.y&&(e.over(),Main.jiFenBoxNode.firstElementChild.innerHTML="分数:".concat(++Main.fenshu),500==i.aiDaCiShu++&&(Main.haveBoss=!1,i.over()))}),i.xueTiaoNode.style.borderLeft="".concat(.64*(500-i.aiDaCiShu),"px solid red"),Main.myPlane.x+66>i.x&&Main.myPlane.x<i.x+i.srcObj.w&&Main.myPlane.y<=i.y-16+i.srcObj.h&&Main.myPlane.y+60>i.y&&Main.myPlane.over(),(i.x<=0||i.x>=320-i.srcObj.w)&&(i.tempX=-i.tempX),(n.flag&&i.y<=0||60<=i.y)&&(i.tempY=-i.tempY),0<i.y&&(n.flag=!0),i.x+=.2*i.tempX,i.y+=.2*i.tempY,i.diFangPlaneNode.style.left=i.x+"px",i.diFangPlaneNode.style.top=i.y+"px",i.bossZidanNum++%(parseInt(300*Math.random())+200)==0&&(e=new BossZiDan(i.x+75,i.y+110,Main.myPlane.x+33,Main.myPlane.y+30),Main.myPlane.plane.parentNode.appendChild(e.zidanNode)),void(0!=i.bossZidanNum&&i.bossZidanNum%900==0&&(e=new BossZiDanJiGuang(i.x+51,i.y),Main.myPlane.plane.parentNode.appendChild(e.zidanNode))));var e},10)}},{key:"over",value:function(){var e=this;Main.bgMusic.src="./audio/bgm.mp3",Main.bgMusic.play(),new Audio("./audio/bossover.mp3").play(),clearInterval(this.timer),this.diFangPlaneNode.src=this.srcObj.srcBoom,Main.jiFenBoxNode.lastElementChild.innerHTML="杀敌数:".concat(++Main.shadishu),-1!=Main.timers.indexOf(Main.createDiJiTimer)&&Main.timers.splice(Main.timers.indexOf(Main.createDiJiTimer)),Main.createDiJiTimer=setInterval(function(){main.diPlanRun()},2e3),Main.timers.push(Main.createDiJiTimer),setTimeout(function(){e.diFangPlaneNode.remove()},200),this.xueTiaoNode.remove()}},{key:"overAgin",value:function(){Main.bgMusic.src="./audio/bgm.mp3",Main.bgMusic.play(),clearInterval(this.timer)}}]),n}();_defineProperty(Boss,"flag",!1);var main=new Main(document.querySelector("section"));